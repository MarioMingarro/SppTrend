# 3.4. Filtrar y muestrear (según tu ejemplo)
puntos_filtrados <- puntos_df[puntos_df$year >= 1995 & puntos_df$year <= 2005, ]
puntos_muestra <- puntos_filtrados[sample(nrow(puntos_filtrados), 10), ]
aa <- get_era5_tm(data = puntos_muestra, nc_file = "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc")
View(aa)
ibrary(terra)
library(terra)
library(stringr)
# 1. Definir la ruta del archivo y la capa de interés
nc_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc"
output_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/t2m_2004_04.tif"
variable <- "t2m" # Asumiendo que quieres la temperatura a 2m
# Definir la fecha que buscamos (Febrero de 2006)
target_year <- 2004
target_month <- 4
# 2. Cargar el ráster completo para la variable
# Usamos tryCatch para manejar posibles errores de carga
era5_raster_all <- tryCatch({
terra::rast(nc_file, subds = variable)
}, error = function(e) {
stop(paste("Error al cargar el archivo NetCDF:", conditionMessage(e)))
})
# 3. Obtener la información de tiempo de todas las capas
date_info <- terra::time(era5_raster_all)
# Manejar el caso donde terra::time no funciona (similar a tu función)
if (any(is.na(date_info))) {
# Asumimos una base de tiempo si no se detecta la fecha automáticamente
layer_timestamps <- as.numeric(stringr::str_extract(names(era5_raster_all), "-?\\d+$"))
layer_dates <- as.POSIXct(layer_timestamps, origin = "1970-01-01 00:00:00", tz = "UTC")
} else {
layer_dates <- as.Date(date_info)
}
# 4. Crear un data frame de fechas para identificar el índice
layer_info <- data.frame(
dates = layer_dates,
years = as.numeric(format(layer_dates, "%Y")),
months = as.numeric(format(layer_dates, "%m"))
)
# 5. Encontrar el índice (o número de capa) para Febrero de 2006
layer_index <- which(layer_info$years == target_year & layer_info$months == target_month)
if (length(layer_index) == 0) {
stop(paste("Error: No se encontró la capa para", target_year, "/", target_month))
} else if (length(layer_index) > 1) {
warning("Se encontraron múltiples capas para la fecha objetivo. Usando la primera.")
layer_index <- layer_index[1]
}
# 6. Extraer la capa específica
febrero_2006_capa <- era5_raster_all[[layer_index]]
# 7. Guardar la capa como GeoTIFF
writeRaster(febrero_2006_capa, output_file, overwrite = TRUE)
message(paste("¡Éxito! La capa de", target_year, "/", target_month, "ha sido guardada como:", output_file))
nc_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc"
output_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/t2m_2004_07.tif"
variable <- "t2m" # Asumiendo que quieres la temperatura a 2m
# Definir la fecha que buscamos (Febrero de 2006)
target_year <- 2004
target_month <- 7
# 2. Cargar el ráster completo para la variable
# Usamos tryCatch para manejar posibles errores de carga
era5_raster_all <- tryCatch({
terra::rast(nc_file, subds = variable)
}, error = function(e) {
stop(paste("Error al cargar el archivo NetCDF:", conditionMessage(e)))
})
# 3. Obtener la información de tiempo de todas las capas
date_info <- terra::time(era5_raster_all)
# Manejar el caso donde terra::time no funciona (similar a tu función)
if (any(is.na(date_info))) {
# Asumimos una base de tiempo si no se detecta la fecha automáticamente
layer_timestamps <- as.numeric(stringr::str_extract(names(era5_raster_all), "-?\\d+$"))
layer_dates <- as.POSIXct(layer_timestamps, origin = "1970-01-01 00:00:00", tz = "UTC")
} else {
layer_dates <- as.Date(date_info)
}
# 4. Crear un data frame de fechas para identificar el índice
layer_info <- data.frame(
dates = layer_dates,
years = as.numeric(format(layer_dates, "%Y")),
months = as.numeric(format(layer_dates, "%m"))
)
# 5. Encontrar el índice (o número de capa) para Febrero de 2006
layer_index <- which(layer_info$years == target_year & layer_info$months == target_month)
if (length(layer_index) == 0) {
stop(paste("Error: No se encontró la capa para", target_year, "/", target_month))
} else if (length(layer_index) > 1) {
warning("Se encontraron múltiples capas para la fecha objetivo. Usando la primera.")
layer_index <- layer_index[1]
}
# 6. Extraer la capa específica
febrero_2006_capa <- era5_raster_all[[layer_index]]
# 7. Guardar la capa como GeoTIFF
writeRaster(febrero_2006_capa, output_file, overwrite = TRUE)
message(paste("¡Éxito! La capa de", target_year, "/", target_month, "ha sido guardada como:", output_file))
library(terra)
library(stringr)
# --- 1. Definición y Carga ---
nc_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc"
output_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/t2m_2004_07.tif"
variable <- "t2m"
target_year <- 2004
target_month <- 7
# El CRS objetivo (WGS84, lat/lon -180/180)
target_crs <- "EPSG:4326"
# Cargar el ráster completo para la variable
era5_raster_all <- tryCatch({
terra::rast(nc_file, subds = variable)
}, error = function(e) {
stop(paste("Error al cargar el archivo NetCDF:", conditionMessage(e)))
})
# --- 2. Encontrar la Capa Objetivo (2004-07) ---
date_info <- terra::time(era5_raster_all)
# Manejo de fechas
if (any(is.na(date_info))) {
layer_timestamps <- as.numeric(stringr::str_extract(names(era5_raster_all), "-?\\d+$"))
layer_dates <- as.POSIXct(layer_timestamps, origin = "1970-01-01 00:00:00", tz = "UTC")
} else {
layer_dates <- as.Date(date_info)
}
layer_info <- data.frame(
dates = layer_dates,
years = as.numeric(format(layer_dates, "%Y")),
months = as.numeric(format(layer_dates, "%m"))
)
layer_index <- which(layer_info$years == target_year & layer_info$months == target_month)
if (length(layer_index) == 0) {
stop(paste("Error: No se encontró la capa para", target_year, "/", target_month))
} else if (length(layer_index) > 1) {
warning("Se encontraron múltiples capas para la fecha objetivo. Usando la primera.")
layer_index <- layer_index[1]
}
# 3. Extraer la capa específica
capa_seleccionada <- era5_raster_all[[layer_index]]
# --- 4. Reproyectar la Capa a -180/+180 ---
# La reproyección cambia el rango de longitud de 0-360 (que es el default del NetCDF) a -180/+180
message("Reproyectando la capa a WGS84 (-180/+180) para el archivo TIF.")
# El CRS del NetCDF original (+proj=longlat +R=6367470 +no_defs) es similar a WGS84,
# pero con límites 0-360. Al proyectar a EPSG:4326, terra automáticamente ajusta los límites.
capa_reproyectada <- terra::project(capa_seleccionada, target_crs)
# 5. Guardar la capa reproyectada como GeoTIFF
writeRaster(capa_reproyectada, output_file, overwrite = TRUE)
message(paste("¡Éxito! La capa de", target_year, "/", target_month, "ha sido reproyectada y guardada como:", output_file))
library(terra)
library(stringr)
# --- 1. Definición y Carga ---
nc_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc"
output_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/t2m_1993_1.tif"
variable <- "t2m"
target_year <- 1193
target_month <- 1
# El CRS objetivo (WGS84, lat/lon -180/180)
target_crs <- "EPSG:4326"
# Cargar el ráster completo para la variable
era5_raster_all <- tryCatch({
terra::rast(nc_file, subds = variable)
}, error = function(e) {
stop(paste("Error al cargar el archivo NetCDF:", conditionMessage(e)))
})
# --- 2. Encontrar la Capa Objetivo (2004-07) ---
date_info <- terra::time(era5_raster_all)
# Manejo de fechas
if (any(is.na(date_info))) {
layer_timestamps <- as.numeric(stringr::str_extract(names(era5_raster_all), "-?\\d+$"))
layer_dates <- as.POSIXct(layer_timestamps, origin = "1970-01-01 00:00:00", tz = "UTC")
} else {
layer_dates <- as.Date(date_info)
}
layer_info <- data.frame(
dates = layer_dates,
years = as.numeric(format(layer_dates, "%Y")),
months = as.numeric(format(layer_dates, "%m"))
)
layer_index <- which(layer_info$years == target_year & layer_info$months == target_month)
if (length(layer_index) == 0) {
stop(paste("Error: No se encontró la capa para", target_year, "/", target_month))
} else if (length(layer_index) > 1) {
warning("Se encontraron múltiples capas para la fecha objetivo. Usando la primera.")
layer_index <- layer_index[1]
}
puntos_muestra <- puntos_filtrados[sample(nrow(puntos_filtrados), 10), ]
aa <- get_era5_tm(data = puntos_muestra, nc_file = "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc")
library(terra)
library(stringr)
# --- 1. Definición y Carga ---
nc_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc"
output_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/t2m_2004_1.tif"
variable <- "t2m"
target_year <- 2004
target_month <- 1
# El CRS objetivo (WGS84, lat/lon -180/180)
target_crs <- "EPSG:4326"
# Cargar el ráster completo para la variable
era5_raster_all <- tryCatch({
terra::rast(nc_file, subds = variable)
}, error = function(e) {
stop(paste("Error al cargar el archivo NetCDF:", conditionMessage(e)))
})
# --- 2. Encontrar la Capa Objetivo (2004-07) ---
date_info <- terra::time(era5_raster_all)
# Manejo de fechas
if (any(is.na(date_info))) {
layer_timestamps <- as.numeric(stringr::str_extract(names(era5_raster_all), "-?\\d+$"))
layer_dates <- as.POSIXct(layer_timestamps, origin = "1970-01-01 00:00:00", tz = "UTC")
} else {
layer_dates <- as.Date(date_info)
}
layer_info <- data.frame(
dates = layer_dates,
years = as.numeric(format(layer_dates, "%Y")),
months = as.numeric(format(layer_dates, "%m"))
)
layer_index <- which(layer_info$years == target_year & layer_info$months == target_month)
if (length(layer_index) == 0) {
stop(paste("Error: No se encontró la capa para", target_year, "/", target_month))
} else if (length(layer_index) > 1) {
warning("Se encontraron múltiples capas para la fecha objetivo. Usando la primera.")
layer_index <- layer_index[1]
}
# 3. Extraer la capa específica
capa_seleccionada <- era5_raster_all[[layer_index]]
# --- 4. Reproyectar la Capa a -180/+180 ---
# La reproyección cambia el rango de longitud de 0-360 (que es el default del NetCDF) a -180/+180
message("Reproyectando la capa a WGS84 (-180/+180) para el archivo TIF.")
# El CRS del NetCDF original (+proj=longlat +R=6367470 +no_defs) es similar a WGS84,
# pero con límites 0-360. Al proyectar a EPSG:4326, terra automáticamente ajusta los límites.
capa_reproyectada <- terra::project(capa_seleccionada, target_crs)
# 5. Guardar la capa reproyectada como GeoTIFF
writeRaster(capa_reproyectada, output_file, overwrite = TRUE)
message(paste("¡Éxito! La capa de", target_year, "/", target_month, "ha sido reproyectada y guardada como:", output_file))
library(terra)
library(stringr)
# --- 1. Definición y Carga ---
nc_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc"
# Modificamos el nombre del archivo de salida para reflejar la unidad (Celsius)
output_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/t2m_2003_03_C.tif"
variable <- "t2m"
target_year <- 2003
target_month <- 3
target_crs <- "EPSG:4326"
# Cargar el ráster completo para la variable
era5_raster_all <- tryCatch({
terra::rast(nc_file, subds = variable)
}, error = function(e) {
stop(paste("Error al cargar el archivo NetCDF:", conditionMessage(e)))
})
# --- 2. Encontrar la Capa Objetivo (2004-07) ---
date_info <- terra::time(era5_raster_all)
# Manejo de fechas
if (any(is.na(date_info))) {
layer_timestamps <- as.numeric(stringr::str_extract(names(era5_raster_all), "-?\\d+$"))
layer_dates <- as.POSIXct(layer_timestamps, origin = "1970-01-01 00:00:00", tz = "UTC")
} else {
layer_dates <- as.Date(date_info)
}
layer_info <- data.frame(
dates = layer_dates,
years = as.numeric(format(layer_dates, "%Y")),
months = as.numeric(format(layer_dates, "%m"))
)
layer_index <- which(layer_info$years == target_year & layer_info$months == target_month)
if (length(layer_index) == 0) {
stop(paste("Error: No se encontró la capa para", target_year, "/", target_month))
} else if (length(layer_index) > 1) {
warning("Se encontraron múltiples capas para la fecha objetivo. Usando la primera.")
layer_index <- layer_index[1]
}
# 3. Extraer la capa específica
capa_seleccionada_K <- era5_raster_all[[layer_index]]
# --- 4. Conversión de Kelvin a Celsius ---
message("Convirtiendo la capa de Kelvin a Grados Celsius (°C)...")
# La operación se aplica a todos los valores del ráster
capa_seleccionada_C <- capa_seleccionada_K - 273.15
# --- 5. Reproyectar la Capa a -180/+180 ---
message("Reproyectando la capa a WGS84 (-180/+180) para el archivo TIF.")
# Reproyectamos el ráster ya convertido a Celsius
capa_reproyectada <- terra::project(capa_seleccionada_C, target_crs)
# 6. Guardar la capa reproyectada como GeoTIFF
writeRaster(capa_reproyectada, output_file, overwrite = TRUE)
message(paste("¡Éxito! La capa de temperatura de", target_year, "/", target_month, "ha sido convertida a Celsius y guardada como:", output_file))
# 3.4. Filtrar y muestrear (según tu ejemplo)
puntos_filtrados <- puntos_df[puntos_df$year == 2003 & puntos_df$month == 3, ]
puntos_muestra <- puntos_filtrados[sample(nrow(puntos_filtrados), 10), ]
aa <- get_era5_tm(data = puntos_muestra, nc_file = "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc")
paste0("Error: ", paste(missing_cols, collapse = ", "), "coulumn cannot be found")
missing_cols <- kk
missing_cols <- "aa"
paste0("Error: ", paste(missing_cols, collapse = ", "), "coulumn cannot be found")
get_era5_tm <- function(data, nc_file) {
required_cols <- c("lon", "lat", "year", "month")
if (!all(required_cols %in% names(data))) {
missing_cols <- setdiff(required_cols, names(data))
stop(paste0("Error: ", paste(missing_cols, collapse = ", "), " coulumn cannot be found"))
}
era5_raster <- terra::rast(nc_file, subds="t2m")
num_layers <- terra::nlyr(era5_raster)
date_info <- terra::time(era5_raster)
#como parece que terra::time no siempre funciona, en caso de que devuelva valores NA,
#recurrimos a extraer las fechas de los nombres de los rasters
if (!any(is.na(date_info)))
{
layer=data.frame(dates=as.Date(date_info))
}else{
# extraemos el n?mero situado en la parte final del nombre, incluyendo el signo "-" si existe
layer=data.frame(dates=as.numeric(str_extract(names(era5_raster), "-?\\d+$")))
layer$dates <- as.POSIXct( layer$dates, origin = "1970-01-01 00:00:00", tz = "UTC")
}
# Extract year, month, and day
layer$years <-as.numeric(format(layer$dates, "%Y"))
layer$months <- as.numeric(format(layer$dates, "%m"))
layer$days <- as.numeric(format(layer$dates, "%d"))
if (any(layer$days!=1))
{
stop("Error: Era5 monthly averages expected, but daily values found")
}
print(paste("Raster coverage: From ", min(layer$dates), " to ", max(layer$dates)))
data_years <- unique(data$year)
not_found_years=setdiff(data_years,layer$years)
if (!is.null(not_found_years) & length(not_found_years)>0)
{
if (length(data_years)== length(not_found_years))
{
stop("Error: no data found for any year of the ocurrences")
}
else{
warning(paste(
"No data found for years:", paste(sort(not_found_years), collapse = ", ")
))
}
}
raster_crs <- terra::crs(era5_raster)
original_lon <- data$lon
data$lon[data$lon < 0] <- data$lon[data$lon < 0] + 360
coords_spatvector <- terra::vect(data, geom = c("lon", "lat"), crs = "EPSG:4326")
terra::crs(coords_spatvector) <- raster_crs
unique_year_month_combinations <- unique(data[c("year", "month")])
unique_year_month_combinations=na.omit(unique_year_month_combinations)
unique_year_month_combinations=unique_year_month_combinations[order(unique_year_month_combinations$year,
unique_year_month_combinations$month),]
for(year_month_index in 1:nrow(unique_year_month_combinations))
{
year_month=unique_year_month_combinations[year_month_index,]
selected_row_indexes=which(data$year==year_month$year & data$month==year_month$month)
layer_index <- which(year_month$year==layer$years & year_month$month==layer$months)
print(year_month) ##DEBUGGING. Quitar en versi?n final
if (length(layer_index)==0)
{
data[selected_row_indexes,"temperature"] <- NA
warning(paste(
"No data found for year", year_month$year, "month", year_month$month
))
}
else{
layer_index <- floor(mean(layer_index))
temperatures=terra::extract(era5_raster[[layer_index]],
coords_spatvector[selected_row_indexes],
ID=F)
data[selected_row_indexes,"temperature"]=temperatures - 273.15
null_temps=sapply(data[selected_row_indexes,"temperature" ], is.null)
if (any(null_temps))
{
warning(paste(
"No data found for year", year_month$year, "month", year_month$month,
"at coords",
sapply(data[selected_row_indexes,c("lon", "lat")][null_temps, ],
FUN=function(lonlat){
paste("lon=",lonlat[1],"lat=",lonlat[2])
}),
"\n"
))
}
}
}
data$lon <- original_lon
return(data)
}
aa <- get_era5_tm(data = puntos_muestra, nc_file = "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc")
library(terra)
library(stringr)
# --- 1. Definición y Carga ---
nc_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc"
# Modificamos el nombre del archivo de salida para reflejar la unidad (Celsius)
# **NOTA:** Cambiamos el nombre del output para indicar que mantiene 0-360 longitud
output_file <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/t2m_2003_03_C_0_360.tif"
variable <- "t2m"
target_year <- 2003
target_month <- 3
# target_crs ya no es relevante si no reproyectamos
# Cargar el ráster completo para la variable
era5_raster_all <- tryCatch({
terra::rast(nc_file, subds = variable)
}, error = function(e) {
stop(paste("Error al cargar el archivo NetCDF:", conditionMessage(e)))
})
# --- 2. Encontrar la Capa Objetivo ---
date_info <- terra::time(era5_raster_all)
# Manejo de fechas
if (any(is.na(date_info))) {
layer_timestamps <- as.numeric(stringr::str_extract(names(era5_raster_all), "-?\\d+$"))
layer_dates <- as.POSIXct(layer_timestamps, origin = "1970-01-01 00:00:00", tz = "UTC")
} else {
layer_dates <- as.Date(date_info)
}
layer_info <- data.frame(
dates = layer_dates,
years = as.numeric(format(layer_dates, "%Y")),
months = as.numeric(format(layer_dates, "%m"))
)
layer_index <- which(layer_info$years == target_year & layer_info$months == target_month)
if (length(layer_index) == 0) {
stop(paste("Error: No se encontró la capa para", target_year, "/", target_month))
} else if (length(layer_index) > 1) {
warning("Se encontraron múltiples capas para la fecha objetivo. Usando la primera.")
layer_index <- layer_index[1]
}
# 3. Extraer la capa específica
capa_seleccionada_K <- era5_raster_all[[layer_index]]
# --- 4. Conversión de Kelvin a Celsius ---
message("Convirtiendo la capa de Kelvin a Grados Celsius (°C)...")
# La operación se aplica a todos los valores del ráster
capa_seleccionada_C <- capa_seleccionada_K - 273.15
# --- 5. ELIMINACIÓN DE LA REPROYECCIÓN ---
message("Exportando la capa en su proyección original (longitudes 0-360).")
# 6. Guardar la capa SIN REPROYECTAR como GeoTIFF
# Usamos 'capa_seleccionada_C' directamente
writeRaster(capa_seleccionada_C, output_file, overwrite = TRUE)
message(paste("¡Éxito! La capa de temperatura de", target_year, "/", target_month, "ha sido convertida a Celsius y guardada como:", output_file))
# 3.4. Filtrar y muestrear (según tu ejemplo)
puntos_filtrados <- puntos_df[puntos_df$year == 2003 & puntos_df$month == 3 & puntos_df$lon > 0, ]
puntos_muestra <- puntos_filtrados[sample(nrow(puntos_filtrados), 10), ]
aa <- get_era5_tm(data = puntos_muestra, nc_file = "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES/ERA5_land/era5_land.nc")
library(terra)
# --- 1. Definición de Rutas y Año Objetivo ---
# El año del que quieres extraer los 12 meses
target_year <- 2000
# Ruta de origen del archivo NetCDF
input_nc_file <- "C:/Users/mario/Downloads/GloSATLAT-1-0-0-0_component-series_global_monthly.nc"
# Directorio de destino
output_dir <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES"
# Nombre del archivo de salida GeoTIFF (incluimos el año en el nombre)
output_tif_file <- file.path(output_dir, paste0("GloSATLAT_", target_year, "_monthly.tif"))
message("Iniciando la carga y filtrado para el año: ", target_year)
# --- 2. Cargar el archivo NetCDF ---
rast_all <- tryCatch({
# Carga todas las capas del NetCDF
terra::rast(input_nc_file)
}, error = function(e) {
stop(paste("Error al cargar el archivo NetCDF:", conditionMessage(e)))
})
nc_test <- nc_open("C:/Users/mario/Downloads/GloSATLAT-1-0-0-0_component-series_global_monthly.nc")
library(ncdf4)
nc_test <- nc_open("C:/Users/mario/Downloads/GloSATLAT-1-0-0-0_component-series_global_monthly.nc")
nc_test <- nc_open("C:/Users/mario/Downloads/GloSATLAT-1-0-0-0_component-series_northern-hemisphere_annual.nc")
# --- 1. Definición de Rutas y Año Objetivo ---
# El año del que quieres extraer los 12 meses
target_year <- 2000
# Ruta de origen del archivo NetCDF
input_nc_file <- "C:/Users/mario/Downloads/GloSATLAT-1-0-0-0_component-series_northern-hemisphere_annual.nc"
# Directorio de destino
output_dir <- "C:/A_TRABAJO/A_JORGE/SPP_VIRTUALES"
# Nombre del archivo de salida GeoTIFF (incluimos el año en el nombre)
output_tif_file <- file.path(output_dir, paste0("GloSATLAT_", target_year, "_monthly.tif"))
message("Iniciando la carga y filtrado para el año: ", target_year)
# --- 2. Cargar el archivo NetCDF ---
rast_all <- tryCatch({
# Carga todas las capas del NetCDF
terra::rast(input_nc_file)
}, error = function(e) {
stop(paste("Error al cargar el archivo NetCDF:", conditionMessage(e)))
})
library(ncdf4)
library(raster)
# --- 1. Definir la ruta del archivo NetCDF ---
ruta_nc <- "C:/Users/mario/Downloads/GloSATLAT-1-0-0-0_component-series_northern-hemisphere_annual.nc"
# --- 2. Abrir el archivo NetCDF y obtener el nombre de la variable ---
# Abrir para inspeccionar la estructura y obtener el nombre de la variable
nc_info <- nc_open(ruta_nc)
# Si el archivo tiene múltiples variables, es posible que tengas que elegir.
# Vamos a asumir que quieres la primera variable listada en el archivo.
# Puedes ver los nombres de las variables con: names(nc_info$var)
nombre_variable <- names(nc_info$var)[1] # Esto toma el nombre de la primera variable
# Cerrar la conexión
nc_close(nc_info)
# Para obtener la PRIMERA capa temporal/banda de la variable:
# Usamos 'level=1' o 'band=1' (la indexación suele ser 1 en R, no 0)
raster_capa_1 <- raster(
x = ruta_nc,
varname = nombre_variable,
# 'band' se usa para la dimensión no espacial (ej. tiempo o nivel de profundidad)
# Si es un archivo de series de tiempo, 'band=1' será la primera fecha/paso de tiempo.
band = 1
)
nombre_variable
# Para obtener la PRIMERA capa temporal/banda de la variable:
# Usamos 'level=1' o 'band=1' (la indexación suele ser 1 en R, no 0)
raster_capa_1 <- raster(
x = ruta_nc,
varname = nombre_variable
)
# --- 1. Definir la ruta del archivo NetCDF ---
ruta_nc <- "C:/Users/mario/Downloads/GloSATLAT-1-0-0-0_component-series_northern-hemisphere_annual.nc"
# --- 2. Abrir el archivo NetCDF y obtener el nombre de la variable ---
ss <- terra::rast(ruta_nc, subds="tas")
# Para obtener la PRIMERA capa temporal/banda de la variable:
# Usamos 'level=1' o 'band=1' (la indexación suele ser 1 en R, no 0)
raster_capa_1 <- raster(
x = ruta_nc
)
# Para obtener la PRIMERA capa temporal/banda de la variable:
# Usamos 'level=1' o 'band=1' (la indexación suele ser 1 en R, no 0)
raster_capa_1 <- raster(
x = ruta_nc,
band = 1
)
